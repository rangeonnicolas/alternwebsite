{% extends 'main.html' %}

{% load staticfiles %}

{% block content %}

<section class="contentSection">
    <h1>{{title}}</h1>
    <p class="intro">
        (note: ajouter description)<!--{{description}}-->
    </p>


    <h2>Points d'attention :</h2>

    <div class="mainImpactCont flexContainer flexWrap">

        {% for main_impact in main_impacts %}
        <!--
        <div class="mainImpactBox height1">
            {# {% include "sources_and_alternatives.html" with title=false hasImpactOn=main_impact name=main_impact.impactCateg.name label=main_impact.via entity_alt="alternativetomainimpact" entity_imp="mainimpact" prod='O' only%} #}
        </div>-->
                <div style="width:100%;margin-left:30px">
                        {% with title=false hasImpactOn=main_impact name=main_impact.impactCateg.name label=main_impact.via entity_alt="alternativetomainimpact" entity_imp="mainimpact" prod='O' %}
                                                    {% include "main_impact.html" with name=name label=label id_admin=hasImpactOn.id entity_imp=entity_imp only %}
                        {% endwith %}
                </div>

        {% endfor %}

    </div>

    <span class="admin"><a href="/rest/mainimpact/">(Ajouter un cadre)</a></span>



    <h2>Principales alternatives :</h2>
    <script type="text/javascript">
                                    $(document).foundation();
    </script>




    <div class="mainImpactCont flexContainer flexWrap" style="margin-left:30px">


    {% for behaviour in main_alternatives %}
        {# Attention, dans ce bloc for, il y a confusion entre le terme 'alternative' et 'behaviour' #}

    <div class="mainAlternative" style="width:32.5%;margin:1px;border:2px solid #b3b3b5">


        <div style="flex: 100%">
            <span class="alternativeTitle">
                <div>
                    <img style="width:50px" alt="" src="
                    {% if behaviour.consumeaproduct %}
                    {% static 'maquette/temporaire/icon_basket.png' %}
                    {% elif behaviour.habit %}
                    {% static 'maquette/temporaire/icon_habit.png' %}
                    {% endif %}"/>

                    <div style="display:inline-block;vertical-align:top;width:200px">
                        <span>
                    {% if behaviour.consumeaproduct %}
                    Consommer chez: {{ behaviour.consumeaproduct.product.name }}
                    {% elif behaviour.habit %}
                    {{ behaviour.habit.name }}
                    {% endif %}
                        </span>
                    </div>

                </div>
                <a href="http://lesjoiesducode.fr/post/35336782255/quand-le-client-essaie-de-cliquer-sur-les"><img style="width:100%" alt="" src="{% static 'maquette/temporaire/alternative_cadre.png' %}"/>
                </a>


                    {% with behaviour_id=behaviour.id %}

                    {# todo: simplifier les 2 lignes du dessous avec un tag groupby sinon ça ralentit beaucoup, ou bien faire un tableau general de type {behav_id:{behaviour: <object> main_impacts:[<object>,<object>,...]}} #}
                    {% for behav_id, impacts in main_impact_grouped_by_alternative.items %}
                    {% if behaviour_id == behav_id %}

                    {% for impact in impacts %}
                    <div style="border:yellow 1px solid;width:100%;font-size:0.5em">
                        {% with title=false hasImpactOn=impact name=impact.impactCateg.name label=impact.via entity_alt="alternativetomainimpact" entity_imp="mainimpact" prod='O' %}
                        {% include "main_impact.html" with name=name label=label id_admin=hasImpactOn.id entity_imp=entity_imp only %}
                        {% endwith %}
                    </div>
                    {% endfor %}

                    {% endif %}
                    {% endfor %}

                    {% endwith %}


            </span>
        </div>



    </div>
    {% endfor %}
    </div>



    <h2>Que dit-on de ...?</h2>

    <div style="width:100%;text-align:center">
        <span>
            Rechercher une marque ou un produit:
        </span>
        <div style="margin:5px">
            <a href=""><i style="margin:4px" class="icon-magnifying icon1x"></i></a><input id="search_product_form" type="search"/>
        </div>
    </div>

    <div id="search_product_result" style="border:1px solid #444;padding:5px;display:none">
        <!-- todo:mettre en liste-->
        {% for consprod in consumeaproduct %}
        {% with prod=consprod.product %}
        <div class="habitImpact">

            <div class="habitTitle">
                <span class="productName">
                    <!--<a href="#">     ENLEVE CAR LIEN CACHE PAS BON PR GOOGLE-->
                        <i class="icon-chevron_right"></i>
                    <!--</a>-->
                    {{ prod.name }}</span>
            </div>


            <div class="alternativeToMainImpact">
                {% for hasImpactOn in consprod.has_impact_on.all %}

                <div class="flexContainer" style="margin-bottom: 20px">
                    {% if hasImpactOn.impact_type == 'Neg' %}
                    <div class="logoAlternative thumb"><img class="logoPlusOrMinusImage" src="{% static 'maquette/icons/custom/hand_thumbdown.svg' %}"></img></div>
                    {% elif  hasImpactOn.impact_type == 'Pos' %}
                    <div class="logoAlternative thumb"><img class="logoPlusOrMinusImage" src="{% static 'maquette/icons/custom/hand_thumb.svg' %}"></img></div>
                    {% else %}
                    <div class="logoAlternative thumb"><img class="logoPlusOrMinusImage" src="{% static 'maquette/icons/custom/hand_thumb.svg' %}"></img></div>
                    {% endif %}

                    <div class="alternativeToMainImpactContent flexBoxMaxWidth">

                        {% include 'sources_and_alternatives.html' with title=1 hasImpactOn=hasImpactOn name=hasImpactOn.impactCateg.name label='__?'  entity_alt="alternative" entity_imp="hasimpacton" prod=prod only %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!--<a href="/rest/hasimpacton" alt="" style="font-size:0.8em">(Ajouter un impact)</a>-->


        </div>
        {% endwith %}
        {% endfor %}

    </div>

    (note nico: transformer hasImpactOn.becauseOf.to_rel.product.name en hasImpactOn.becauseOf.to_rel.name)
    <br/>topic dan chacun des behaviour
    <br/>modificaion de chaq elemn rest en cliquant essus
    <br/>mettre les sources démenties
    <br/>tri des sources par date
    <br/> date des sources: date de consultation + parutuon facultatives
    <br/> un seu ls à ressource
    <br/> responsive pas compressible à fond

    <script type="text/javascript">
        $(function(){
            $("#search_product_form").on('keyup',function(){
                $("#search_product_result").show();
            });
        });
    </script>

</section>
{% endblock %}
<!--
<iframe
  src="http://www.koom.org/web/jsp/api/action.jsp?idaction=17&displayMap=0"
  frameborder="0" scrolling="no"
  width="310" height="500">
</iframe>

 <script type="text/javascript">
 	var csList = document.getElementsByClassName("contentSection");
	var cs = csList[0];
	var csStyle = cs.currentStyle || window.getComputedStyle(cs);
	var origPadding = parseInt(csStyle.paddingRight);alert(origPadding);

	window.onresize = function(event){
		if(csStyle.width == csStyle.minWidth){
			for(i=0; i<csList.length; i++){
				p = csList[i];
				p.style.paddingLeft = 2;
				p.style.paddingRight = 2;
			}
		}
		else{
			for(i=0; i<csList.length; i++){
				p = csList[i];
				p.style.paddingLeft = origPadding;
				p.style.paddingRight = origPadding;
			}
		}
	}
</script>

 -->

<!--

  <i class="icon-plus icon3x"></i>
 <i class="icon-pen icon3x"></i>
  <i class="icon-sheet icon3x"></i>
   <i class="icon-file_open icon3x"></i>
    <i class="icon-file_alt icon3x"></i>
     <i class="icon-attachment icon3x"></i>
      <i class="icon-cross_mark icon3x"></i>
       <i class="icon-file_close_alt icon3x"></i>
        <i class="icon-file_close icon3x"></i>
         <i class="icon-cancel_circle icon3x"></i>
<i class="icon-magnifying icon3x"></i>
<i class="icon-warning icon3x"></i>
<i class="icon-warning_alt icon3x"></i>
<i class="icon-magnifying_plus icon3x"></i>
<i class="icon-white_question icon3x"></i>
<i class="icon-black_question icon3x"></i>
<i class="icon-eye icon3x"></i>
<i class="icon-newspaper icon3x"></i>
<i class="icon-mute_off  icon3x"></i>
<i class="icon-users  icon3x"></i>
<i class="icon-message  icon3x"></i>
<i class="icon-discussion  icon3x"></i>
<i class="icon-video_camera icon3x"></i> -->


<!--
	checklist:
	- pas de redondance de description meta
    - pas de lien <a> en hidden (referencement google)
	- titres en h1 h2
	- balises header, footer, nav, section(=grandes sections de la page), aside(=infos complementaires), article (https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/structurer-sa-page)
	- pas de texte en dehors de balises
	- utilisation de balises spécifiques (https://openclassrooms.com/courses/apprenez-a-creer-votre-site-web-avec-html5-et-css3/memento-des-balises-html)
	- s'assurer que tous les <img> on un alt, même chaine de caractère vide si besoin
-->